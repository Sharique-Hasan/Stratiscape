<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>mpalmerlee/Stratiscape @ GitHub</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
	  margin-bottom: 1.0em;
      background-color: #007F0E;
      font-family: "Helvetica,Arial,FreeSans";
      color: #ffffff;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #3366ff; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #3366ff; }
    h3 { text-align: center; color: #3366ff; }
    a { color: #3366ff; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  </style>
  <script type="text/javascript" src="jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="js-inherit.js"></script>
<script type="text/javascript" src="jCanvas.js"></script>
<script type="text/javascript" src="pinwheel.js"></script>
<script type="text/javascript" src="dandelion-background.js"></script>
<script type="text/javascript" charset="utf-8">

function rotatePinwheel(){
	Pinwheel.rotateWheels(-5);
	document.wheelLayer.needsDisplay = true;//set dirtyflag
}

function populatePinwheels() {
	Pinwheel.populateWheels();//create our wheels
	//add the wheels to the canvas
	for(var i in Pinwheel.wheels)
	{
		document.wheelLayer.addChild(Pinwheel.wheels[i]);
	}
}

function changeWindDirection() {
	DandelionBackground.windAngle += DandelionBackground.nextRandomFloat(-5, 5);
	if(DandelionBackground.windSpeed > 2)
		DandelionBackground.windSpeed += DandelionBackground.nextRandomFloat(-0.5, 0.5);
	else
		DandelionBackground.windSpeed += DandelionBackground.nextRandomFloat(0, 2);
	
	document.windVane.angle = DandelionBackground.windAngle;
	document.windVane.speed = DandelionBackground.windSpeed;
	document.bgLayer.needsDisplay = true;
	//$('#debugData').text('Wind Angle: ' + DandelionBackground.windAngle + ', Wind Speed: ' + DandelionBackground.windSpeed);
}

function moveDandelions() {
	DandelionBackground.moveDandelions();
	document.fgLayer.needsDisplay = true;//set dirtyflag
}

function populateDandelions() {
	//add the dandelions to the canvas
	for(var i in DandelionBackground.dandelions)
	{
		document.fgLayer.addChild(DandelionBackground.dandelions[i]);
	}
}


WindVane = jCanvas.DrawnObject.extend({ //vane drawn object class

	init: function(x, y, width, height, angle, speed) {
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
		
		this.angle = angle;
		this.speed = speed;
		
		this.image = new Image();
		//this.image.onload = function() {
		//	
		//};
		this.image.src = "img/WindVane.png";
	},
	
	draw: function(ctx) {
		
		//draw image
		if(this.angle != 90)
		{
			ctx.save();
			ctx.translate( this.x + this.width/2, this.y + this.height/2 );
			ctx.rotate( (this.angle - 90) * DandelionBackground.degreesToRad);
			ctx.translate( -this.width/2, -this.height/2 );
			ctx.drawImage( this.image, 0, 0 );
			ctx.restore();
		}
		else
			ctx.drawImage(this.image, this.x, this.y);
		
		//draw text for wind direction and wind speed
		var friendlyWindSpeed = this.speed.toFixed(2);//2 decimal spaces
		var friendlyWindDirection = this.angle;
		while(friendlyWindDirection > 360)
			friendlyWindDirection -= 360;
		while(friendlyWindDirection < 0)
			friendlyWindDirection += 360;
		
		friendlyWindDirection = friendlyWindDirection.toFixed(2);//2 decimal spaces
		
		ctx.fillStyle = "green";
		ctx.font = "bold 9px sans-serif";
		ctx.textAlign = "left";
		ctx.textBalseline = 'top';
		//var textWidth = ctx.measureText(this.Planet.BoundingHex.Id);
		ctx.fillText(friendlyWindSpeed + " MPH, " + friendlyWindDirection + "°", this.x - 12, this.y + this.height + 8);
	}
});

$(document).ready(function() {
	document.jCanvasDraw = new jCanvas({'containerSelector':'#canvasContainer',
								'layers':[
									{'name':'canvasPinwheelBackground', x:0, y:0, width:640, height:480,'zIndex':1, 'backgroundColor':'black'},
									{'name':'canvasPinwheelWheels', x:170, y:90, width:300, height:300,'zIndex':2},
									{'name':'canvasPinwheelForeground', x:0, y:0, width:640, height:480,'zIndex':3}
								]
							});
	document.wheelLayer = document.jCanvasDraw.getLayer('canvasPinwheelWheels');
	document.bgLayer = document.jCanvasDraw.getLayer('canvasPinwheelBackground');
	document.fgLayer = document.jCanvasDraw.getLayer('canvasPinwheelForeground');
	
	document.windVane = new WindVane(571,5, 64, 64, 90, 0);
	document.bgLayer.addChild(document.windVane);
	
	changeWindDirection();
	
	DandelionBackground.populateDandelions(160, populateDandelions);//create our background dandelions
	
	Pinwheel.init(populatePinwheels);
	
	setInterval('document.jCanvasDraw.draw()', 50);
	
	setInterval('rotatePinwheel()', 100);
	
	setInterval('moveDandelions()', 33);
	
	setInterval('changeWindDirection()', 1000);
});
</script>
</head>

<body>
  <a href="http://github.com/mpalmerlee/Stratiscape"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
      <a href="http://github.com/mpalmerlee/Stratiscape/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/mpalmerlee/Stratiscape/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/mpalmerlee/Stratiscape">Stratiscape</a>
      <span class="small">by <a href="http://github.com/mpalmerlee">mpalmerlee</a></span></h1>

    <div class="description">
      Simple HTML5 Canvas library supporting multiple layers and a drawn object model.  Currently Strariscape is in Pre-Alpha stages, working on examples and documentation, also changing the name to StratiScape.
    </div>

    <p>Stratiscape - Multi-Layer Javascript Canvas Library</p><h2>Dependencies</h2>
<p>jQuery and John Resig's Simple JavaScript Inheritance library</p>
<h2>License</h2>
<p>MIT License</p>
<h2>Authors</h2>
<p>Matt Palmerlee<br/><br/>      </p>



    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="http://github.com/mpalmerlee/Stratiscape/zipball/master">zip</a> or
      <a href="http://github.com/mpalmerlee/Stratiscape/tarball/master">tar</a> formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/mpalmerlee/Stratiscape</pre>
    </p>

    <div class="footer">
      get the source code on GitHub : <a href="http://github.com/mpalmerlee/Stratiscape">mpalmerlee/Stratiscape</a>
    </div>

  
	<br />
	<h2>Example Built using Stratiscape:</h2>
	<p>Pinwheel and Dandelions:<br/>      </p>

	<div>

	<div id="canvasContainer" style="position: relative;"></div>
	
	<p> Example of multiple layers drawn independently. More examples to come. <p/>
	</div>
	
  <br />
  <br />
</div>

</body>
</html>
